{% load comments %}
{% load threadedcomments_tags %}
{% for category in categories %}
<div class="category">
    <div class="category_title">
        {{category.title}}
    </div>
    <div class="category_tags">
        Tags: 
        {% for tag in category.tags.all %}
        <div class="category_tag">
            {{tag.name}}
        </div>
        {% endfor %}
    </div>
    <div class="category_posts">
        {% for post in category.posts.all %}
        <div class="post">
            <div class="post_date">
                {{ post.post_date }}
            </div>
            <div class="post_title">
                {{ post.title }}
            </div>
            <figure class="post_figure">
                <img src="{{post.picture.url}}" />
                <figcaption class="post_caption">
                    <blockquote>
                        {{ post.caption }}
                    </blockquote>
                </figcaption>
            </figure>
            <div class="comments">
                <hr>{% get_comment_list for post as comment_list %}
                <ul>
                    {% for comment in comment_list|fill_tree|annotate_tree %}
                    <li>
                        {{comment}}
                    </li>
					{% endfor %}
                </ul>
            </div>
            <div class="comments_form">
                {% get_comment_form for post as comment_form %}
				<form action="{{ comment_form_target }}" method="post" class="comment_form">
						{% csrf_token %}
						{{ comment_form }}
						<input type="submit" name="preview" class="submit-post" value="Preview">
						<input type="submit" name="post" class="submit-post" value="Post">
					</form>
            </div>
            <div class="post_tags">
                Tags: 
                {% for tag in post.tags.all %}
                <div class="post_tag">
                    {{ tag.name }}
                </div>
                {% endfor %}
            </div>
        </div>{% endfor %}
    </div>
</div>{% endfor %}